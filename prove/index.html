<!DOCTYPE html>
<html>

<head>
  <link class="jsbin" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1/themes/base/jquery-ui.css" rel="stylesheet"
    type="text/css" />
  <script class="jsbin" src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
  <script class="jsbin" src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.0/jquery-ui.min.js"></script>
  <meta charset="utf-8" />
  <title>JS Bin</title>
  <!--[if IE]>
    <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  <style>
    article,
    aside,
    figure,
    footer,
    header,
    hgroup,
    menu,
    nav,
    section {
      display: block;
    }
  </style>
</head>

<body>
  <input type="file" name="filename" accept="image/gif, image/jpeg, image/png" />
  <input type="button" value="Visualizza" onclick="caricaFile()" />
  <canvas id="canvas" height="1000" width="1000"></canvas>
  <script>
    const img = new Image();
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");
    let hoveredColor;
    let selectedColor;
    function caricaFile()
    {
      let input = document.querySelector('input[type="file"]');
      let file = input.files[0];
      img.crossOrigin = "anonymous";
      img.src = URL.createObjectURL(file);
      img.addEventListener("load", () => {
        ctx.drawImage(img, 0, 0);
        img.style.display = "none";
        hoveredColor = document.getElementById("hovered-color");
        selectedColor = document.getElementById("selected-color");
      });
    }

    function pick(event, destination) {
      const bounding = canvas.getBoundingClientRect();
      const x = event.clientX - bounding.left;
      const y = event.clientY - bounding.top;
      const pixel = ctx.getImageData(x, y, 1, 1);
      const data = pixel.data;

      const rgba = `rgba(${data[0]}, ${data[1]}, ${data[2]}, ${data[3] / 255})`;
      destination.style.background = rgba;
      destination.textContent = rgba;

      return rgba;
    }

    canvas.addEventListener("mousemove", (event) => pick(event, hoveredColor));
    canvas.addEventListener("click", (event) => pick(event, selectedColor));


  </script>
</body>

</html>